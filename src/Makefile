include Rules.make

SUBDIRS = models
SUBDIRS = models drivers

DOCSRC	= fabm.F90 fabm_types.F90

FABMMOD	 = ${LIBFABM}(fabm.o)
FABMBASE = ${LIBFABM}(fabm_standard_variables.o) ${LIBFABM}(fabm_properties.o) ${LIBFABM}(fabm_types.o)
FABMMODELLIB = ${LIBFABM}(fabm_library.o)

all: makedirs $(FABMBASE) $(FABMMOD)
        $(MOVE_MODULES_COMMAND)

makedirs:
	mkdir -p $(MODDIR) $(LIBDIR)

$(FABMBASE): driver

driver:
	$(MAKE) -C drivers/$(FABMHOST)

$(FABMMOD): models $(FABMMODELLIB)

models: driver $(FABMBASE)
	$(MAKE) -C models

0d getm gotm:
	( export FABMHOST=$@ ; $(MAKE) )

doc:    $(DOCSRC)
	$(PROTEX) $(DOCSRC) > ../doc/fabm_interface_code.tex
	set -e; for i in $(SUBDIRS); do $(MAKE) -C $$i $@; done

clean:
	$(RM) -f *.o *~
	set -e; for i in $(SUBDIRS); do $(MAKE) -C $$i $@; done

realclean: clean
	$(RM) -r $(FABMDIR)/modules/$(FABMHOST)/$(FORTRAN_COMPILER)
	$(RM) -r $(FABMDIR)/lib/$(FABMHOST)/$(FORTRAN_COMPILER)

distclean: realclean
	$(RM) -r doc
	$(RM) -r $(FABMDIR)/modules/ $(FABMDIR)/lib/

.PHONY: makedirs models driver
